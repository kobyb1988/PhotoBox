<UserControl x:Class="ImageMaker.AdminView.Controls.TemplateExplorerCtl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:ImageMaker.CommonView.Converters;assembly=ImageMaker.CommonView"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:command="http://www.galasoft.ch/mvvmlight"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:viewModels="clr-namespace:ImageMaker.AdminViewModels.ViewModels;assembly=ImageMaker.AdminViewModels"
             xmlns:images="clr-namespace:ImageMaker.AdminViewModels.ViewModels.Images;assembly=ImageMaker.AdminViewModels"
             xmlns:spinningWheel="clr-namespace:Hammer.SpinningWheel;assembly=Hammer.SpinningWheel"
             xmlns:customControls="clr-namespace:ImageMaker.Themes.CustomControls;assembly=ImageMaker.Themes"
             xmlns:converters1="clr-namespace:ImageMaker.AdminView.Converters"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance viewModels:TemplateExplorerViewModel}"
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:ByteArrayToImageConverter x:Key="ByteArrayToImageConverter" />
        <converters:DoubleValueConverterExt x:Key="DoubleValueConverterExt" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <CollectionViewSource Source="{Binding Path=Children}" IsLiveFilteringRequested="True" x:Key="Source">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Filter">
                    <command:EventToCommand Command="{Binding Mode=OneWay, Path=FilterCommand}" 
                            PassEventArgsToCommand="True" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <CollectionViewSource.LiveFilteringProperties>
                <system:String>State</system:String>
            </CollectionViewSource.LiveFilteringProperties>
        </CollectionViewSource>
    </UserControl.Resources>

    <Border Padding="85,25">
        <Border.Background>
            <ImageBrush ImageSource="../Resources/blur.jpg" Stretch="UniformToFill" />
        </Border.Background>
        <Viewbox Stretch="Uniform">
            <Grid Width="900" Height="800">
                <Grid.RowDefinitions>
                    <RowDefinition Height="0.14*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="0.2*" />
                </Grid.RowDefinitions>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="0.6*"/>
                        <ColumnDefinition />
                        <ColumnDefinition Width="0.65*"/>
                    </Grid.ColumnDefinitions>
                    <Image Source="../Resources/templates.png" Margin="12,0,0,0"/>
                    <Grid  Grid.Column="2" Margin="0,0,10,0">
                        <Grid.Resources>
                            <Style TargetType="{x:Type Button}" BasedOn="{StaticResource OpaqueButtonStyle}">
                                <Setter Property="Margin" Value="3" />
                            </Style>
                        </Grid.Resources>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Button Content="" Background="#c7f464" Command="{Binding Path=AddTemplateCommand}"/>
                            <Rectangle IsHitTestVisible="False">
                                <Rectangle.Fill>
                                    <ImageBrush ImageSource="../Resources/icons.png" Viewbox=".01,0,.5,.5">
                                        <ImageBrush.Transform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="0.6" ScaleY="0.6"></ScaleTransform>
                                            </TransformGroup>
                                        </ImageBrush.Transform>
                                        <ImageBrush.RelativeTransform>
                                            <TranslateTransform X="0.35" Y="0.3"></TranslateTransform>
                                        </ImageBrush.RelativeTransform>
                                    </ImageBrush>
                                </Rectangle.Fill>
                            </Rectangle>
                            <TextBlock VerticalAlignment="Bottom" Text="добавить" Foreground="#ffffff" Grid.Row="1" HorizontalAlignment="Center"/>
                        </Grid>
                        <Grid Grid.Column="1">
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Button Content="" Background="#ff6b6b" Command="{Binding Path=RemoveTemplateCommand}"/>
                            <Rectangle IsHitTestVisible="False">
                                <Rectangle.Fill>
                                    <ImageBrush ImageSource="../Resources/icons.png" Viewbox=".49,0,.5,.5">
                                        <ImageBrush.Transform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="0.6" ScaleY="0.6"></ScaleTransform>
                                            </TransformGroup>
                                        </ImageBrush.Transform>
                                        <ImageBrush.RelativeTransform>
                                            <TranslateTransform X="0.35" Y="0.3"></TranslateTransform>
                                        </ImageBrush.RelativeTransform>
                                    </ImageBrush>
                                </Rectangle.Fill>
                            </Rectangle>
                            <TextBlock VerticalAlignment="Bottom" Text="удалить" Foreground="#ffffff" Grid.Row="1" HorizontalAlignment="Center"/>
                        </Grid>
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Button Content="" Background="#4ecdc4" Command="{Binding Path=UpdateTemplateCommand}"/>
                            <Rectangle IsHitTestVisible="False">
                                <Rectangle.Fill>
                                    <ImageBrush ImageSource="../Resources/icons.png" Viewbox=".01,.44,.5,.5">
                                        <ImageBrush.Transform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="0.6" ScaleY="0.6"></ScaleTransform>
                                            </TransformGroup>
                                        </ImageBrush.Transform>
                                        <ImageBrush.RelativeTransform>
                                            <TranslateTransform X="0.35" Y="0.3"></TranslateTransform>
                                        </ImageBrush.RelativeTransform>
                                    </ImageBrush>
                                </Rectangle.Fill>
                            </Rectangle>
                            <TextBlock VerticalAlignment="Bottom" Text="изменить" Foreground="#ffffff" Grid.Row="1" HorizontalAlignment="Center"/>
                        </Grid>
                        <Grid Grid.Column="3">
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Button Content="" Background="#4ecdc4" Command="{Binding Path=SetInstaPrinterTemplateCommand}"/>
                            <Path Grid.Row="0" Data="M15.96544,11.527015C15.729448,11.526008 15.497452,11.543037 15.269455,11.576026 13.070446,11.901008 11.333444,13.79203 11.319436,16.027015 11.310434,17.554023 11.983439,18.898017 13.051434,19.764015L13.109448,19.810035 13.139446,19.833015C13.904433,20.423011 14.862441,20.77201 15.912431,20.778022 18.412436,20.793037 20.542444,18.728034 20.557459,16.275031 20.574457,13.623023 18.560446,11.541023 15.96544,11.527015z M0.32741368,11.413032C3.2514295,11.426032 6.1754153,11.421027 9.0994313,11.422035 9.1364186,11.422035 9.1724293,11.433021 9.2634327,11.448035 7.7184169,13.814033 7.3444235,16.326026 8.3014261,18.978034 8.9324391,20.725013 10.072425,22.087013 11.655436,23.066016 14.773452,24.997016 18.830435,24.573035 21.480463,22.082008 24.125458,19.597022 25.108462,15.214027 22.556454,11.42002L24.93747,11.42002C27.123448,11.42002 29.310463,11.426032 31.497479,11.413032 31.78648,11.412025 31.864453,11.485023 31.863476,11.778022 31.854473,16.462013 31.864453,21.146034 31.854473,25.830024 31.847454,29.182014 29.002449,31.99903 25.649447,32.000007 19.180441,32.000007 12.711436,32.000007 6.2414248,32.000007 2.8654122,32.000007 0.026418158,29.18003 0.02242046,25.80503 0.015401294,21.13401 0.021413266,16.464027 0.018422655,11.793037 0.017415457,11.568031 0.0054220293,11.411018 0.32741368,11.413032z M15.94243,9.8670113C19.386437,9.8700326 22.185452,12.673011 22.20245,16.136024 22.219448,19.618018 19.403435,22.424018 15.892442,22.423011 12.443431,22.422035 9.6404173,19.622016 9.6244261,16.163032 9.609442,12.697028 12.451427,9.8650277 15.94243,9.8670113z M26.272465,2.6470101C25.709444,2.6470101 25.146456,2.6510079 24.584442,2.658027 24.313446,2.6620248 24.086457,2.7420113 23.91745,2.8830331 23.700468,3.0640328 23.577452,3.3460152 23.574461,3.6920238 23.569456,4.2610238 23.572447,4.830024 23.573454,5.4000313 23.573454,5.9690316 23.567442,6.5380318 23.574461,7.1070321 23.58145,7.7180245 23.985443,8.1190255 24.601471,8.1220162 25.713473,8.1280282 26.826451,8.1290353 27.938452,8.1220162 28.418463,8.1190255 28.784462,7.850013 28.907479,7.4360116 28.93647,7.3400338 28.951454,7.237037 28.952461,7.1280282 28.962471,5.9760201 28.961464,4.8250191 28.952461,3.6740184 28.948464,3.080024 28.554451,2.6670296 27.960455,2.659034 27.397467,2.6510079 26.834446,2.6470101 26.272465,2.6470101z M8.7224161,6.803402E-06C14.401442,0.011023779 20.080437,0.002021093 25.758455,0.010016571 28.810463,0.014014501 31.58247,2.5810311 31.814465,5.6280282 31.930464,7.1500313 31.829479,8.678016 31.862469,10.204017 31.868481,10.464027 31.736462,10.456031 31.554455,10.455024 30.156473,10.452033 28.759468,10.45301 27.362463,10.45301 25.616457,10.45301 23.870451,10.449012 22.12344,10.458015 21.852444,10.459022 21.653439,10.395026 21.442438,10.199012 18.284445,7.2600167 13.439435,7.2970345 10.312446,10.276008 10.166419,10.415015 10.023444,10.457008 9.833441,10.456031 6.6774304,10.452033 3.5204119,10.45301 0.36440099,10.45301 0.19240354,10.45301 0.0074056751,10.513007 0.014424851,10.205024 0.051412095,8.6680367 -0.072581033,7.1240304 0.072408264,5.5920174 0.24541267,3.7730172 1.1364053,2.3290169 2.5864203,1.2260202 2.6024112,1.2130196 2.6314335,1.2170174 2.7024176,1.2060312 2.7024176,3.3410104 2.7094061,5.4490121 2.6954291,7.5560372 2.6924078,7.8600228 2.7704108,7.9410165 3.0734203,7.9340279 3.9564173,7.9160226 3.9574244,7.9300301 3.9574246,7.0570138 3.9574244,4.961036 3.9564173,2.8650277 3.9574246,0.77002652 3.9574244,0.4890206 4.5794346,0.079016943 4.8244302,0.20502393 4.9544356,0.27103354 4.8864114,0.41303184 4.8874185,0.5180123 4.8914163,2.5740121 4.8904092,4.6310189 4.8904092,6.6880257L4.8904092,6.9590218C4.8904092,7.9390328 4.8904092,7.929023 5.8414304,7.9330208 6.1094362,7.9340279 6.191437,7.8650277 6.1874392,7.5900338 6.1724245,6.4260323 6.1814272,5.2620309 6.1814272,4.0970223 6.1814272,2.8430245 6.1994326,1.5870125 6.1714174,0.33301469 6.1624148,-0.09798501 6.4254157,0.021033544 6.6464245,0.0080329283 6.883424,-0.0049674324 7.0774247,-0.040978175 7.074434,0.34201737 7.0534379,2.7350228 7.0704362,5.1280282 7.0564286,7.5210335 7.0544145,7.8340218 7.1184404,7.9420235 7.4514181,7.935035 8.3544352,7.9150155 8.3554423,7.9310372 8.3554423,7.0280221 8.3554423,4.8160165 8.3604166,2.6040108 8.3494303,0.39203568 8.3474161,0.10303428 8.4014323,-0.00096962962 8.7224161,6.803402E-06z" Stretch="Uniform" Fill="#FFFFFFFF" Width="26" Height="26" Margin="0,0,0,0" RenderTransformOrigin="0.5,0.5">
                                <Path.RenderTransform>
                                    <TransformGroup>
                                        <TransformGroup.Children>
                                            <RotateTransform Angle="0" />
                                            <ScaleTransform ScaleX="1" ScaleY="1" />
                                        </TransformGroup.Children>
                                    </TransformGroup>
                                </Path.RenderTransform>
                            </Path>
                            <TextBlock VerticalAlignment="Bottom" Text="InstaPrinter" Foreground="#ffffff" Grid.Row="1" HorizontalAlignment="Center"/>
                        </Grid>
                    </Grid>
                </Grid>
                <Border Grid.Row="1">
                    <Grid>
                        <Grid.Resources>

                            <DataTemplate x:Key="tmpl" DataType="{x:Type images:CheckableTemplateViewModel}">
                                <ToggleButton ClickMode="Release"
                                        IsChecked="{Binding Path=IsChecked}"
                                        Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBox}, Path=DataContext.CheckCommand}">
                                    <ToggleButton.Style>
                                        <Style TargetType="{x:Type ToggleButton}">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                        <Border x:Name="RootBorder"
                                                                Margin="10"
                                                                Background="Transparent"
                                                                BorderBrush="Transparent" BorderThickness="2" 
                                                                Width="157.4"
                                                                Height="157.4">
                                                            <Grid x:Name="rootGrid"
                                                                    ToolTip="{Binding Path=Name}">
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="7*"/>
                                                                    <RowDefinition Height="3*"/>
                                                                </Grid.RowDefinitions>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="7*"/>
                                                                    <ColumnDefinition Width="6*"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Viewbox Stretch="Uniform"
                                                                        Grid.RowSpan="2"
                                                                        Grid.ColumnSpan="2"
                                                                        Margin="5">
                                                                    <ItemsControl ItemsSource="{Binding Path=Children}"
                                                                            Width="{Binding Path=Background.Width}"
                                                                            Height="{Binding Path=Background.Height}">
                                                                        <ItemsControl.Background>
                                                                            <ImageBrush ImageSource="{Binding Path=Background.Data, Converter={StaticResource ByteArrayToImageConverter}}" Stretch="Uniform" />
                                                                        </ItemsControl.Background>
                                                                        <ItemsControl.ItemsPanel>
                                                                            <ItemsPanelTemplate>
                                                                                <Canvas IsItemsHost="True" 
                                                                                        Width="{Binding Width}" 
                                                                                        Height="{Binding Height}">
                                                                                    <Canvas.Background>
                                                                                        <ImageBrush ImageSource="{Binding Path=Overlay.Data, Converter={StaticResource ByteArrayToImageConverter}}" />
                                                                                    </Canvas.Background>
                                                                                </Canvas>
                                                                            </ItemsPanelTemplate>
                                                                        </ItemsControl.ItemsPanel>
                                                                        <ItemsControl.Template>
                                                                            <ControlTemplate TargetType="{x:Type ItemsControl}">
                                                                                <Border Padding="{TemplateBinding Padding}"
                                                                                        Width="{TemplateBinding Width}"
                                                                                        Height="{TemplateBinding Height}"
                                                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                                                        BorderThickness="{TemplateBinding BorderThickness}" 
                                                                                        Background="{TemplateBinding Background}">
                                                                                    <Viewbox Stretch="Fill" >
                                                                                        <ItemsPresenter />
                                                                                    </Viewbox>
                                                                                </Border>
                                                                            </ControlTemplate>
                                                                        </ItemsControl.Template>
                                                                        <ItemsControl.ItemContainerStyle>
                                                                            <Style>
                                                                                <Setter Property="Canvas.Left">
                                                                                    <Setter.Value>
                                                                                        <MultiBinding Converter="{StaticResource DoubleValueConverterExt}" UpdateSourceTrigger="PropertyChanged">
                                                                                            <Binding Path="X" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                                                                            <Binding Path="DataContext.Width" RelativeSource="{RelativeSource AncestorType={x:Type ItemsControl}}" />
                                                                                        </MultiBinding>
                                                                                    </Setter.Value>
                                                                                </Setter>
                                                                                <Setter Property="Canvas.Top">
                                                                                    <Setter.Value>
                                                                                        <MultiBinding Converter="{StaticResource DoubleValueConverterExt}" UpdateSourceTrigger="PropertyChanged">
                                                                                            <Binding Path="Y" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                                                                            <Binding Path="DataContext.Height" RelativeSource="{RelativeSource AncestorType={x:Type ItemsControl}}" />
                                                                                        </MultiBinding>
                                                                                    </Setter.Value>
                                                                                </Setter>
                                                                            </Style>
                                                                        </ItemsControl.ItemContainerStyle>
                                                                        <ItemsControl.ItemTemplate>
                                                                            <DataTemplate DataType="{x:Type images:TemplateImageViewModel}">
                                                                                <Label>
                                                                                    <Label.Width>
                                                                                        <MultiBinding Converter="{StaticResource DoubleValueConverterExt}" UpdateSourceTrigger="PropertyChanged">
                                                                                            <Binding Path="Width" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                                                                            <Binding Path="DataContext.Width" RelativeSource="{RelativeSource AncestorType={x:Type ItemsControl}}" />
                                                                                        </MultiBinding>
                                                                                    </Label.Width>
                                                                                    <Label.Height>
                                                                                        <MultiBinding Converter="{StaticResource DoubleValueConverterExt}" UpdateSourceTrigger="PropertyChanged">
                                                                                            <Binding Path="Height" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"/>
                                                                                            <Binding Path="DataContext.Height" RelativeSource="{RelativeSource AncestorType={x:Type ItemsControl}}" />
                                                                                        </MultiBinding>
                                                                                    </Label.Height>
                                                                                    <Label.Style>
                                                                                        <Style TargetType="{x:Type Label}">
                                                                                            <Setter Property="BorderBrush" Value="Black" />
                                                                                            <Setter Property="BorderThickness" Value="2" />
                                                                                            <Setter Property="Template">

                                                                                                <Setter.Value>
                                                                                                    <ControlTemplate TargetType="{x:Type Label}">
                                                                                                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                                                                                                BorderThickness="{TemplateBinding BorderThickness}"  
                                                                                                                Height="{TemplateBinding Height}"
                                                                                                                Width="{TemplateBinding Width}">
                                                                                                            <Rectangle Fill="Gray" />
                                                                                                        </Border>
                                                                                                    </ControlTemplate>
                                                                                                </Setter.Value>
                                                                                            </Setter>
                                                                                        </Style>
                                                                                    </Label.Style>
                                                                                </Label>
                                                                            </DataTemplate>
                                                                        </ItemsControl.ItemTemplate>
                                                                    </ItemsControl>
                                                                </Viewbox>

                                                                <Rectangle Fill="#4ecdc4" Grid.RowSpan="2" Grid.ColumnSpan="2" Opacity="0" x:Name="overlay"/>
                                                                <DockPanel Grid.Row="1" Grid.Column="1">
                                                                    <Path  
                                                                        Data="M15.996017,6.2280555L15.996017,19.724012 21.988997,23.894998 19.699997,17.146998 25.616996,13.028999 18.302998,13.028999z M15.995997,0L19.735997,11.027999 31.991996,11.027999 22.076997,17.928998 25.834996,29.008996 15.995997,22.160997 6.1569989,29.008996 9.9149985,17.928998 0,11.027999 12.255998,11.027999z" Stretch="Uniform" Fill="#FFFFFFFF" Width="26" Height="26" Margin="0,0,0,0" RenderTransformOrigin="0.5,0.5">
                                                                        <Path.RenderTransform>
                                                                            <TransformGroup>
                                                                                <TransformGroup.Children>
                                                                                    <RotateTransform Angle="0" />
                                                                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                                                                </TransformGroup.Children>
                                                                            </TransformGroup>
                                                                        </Path.RenderTransform>
                                                                        <Path.Style>
                                                                            <Style TargetType="{x:Type Path}">
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding IsInstaPrinterTemplate,UpdateSourceTrigger=PropertyChanged}" Value="True" >
                                                                                        <Setter Property="Opacity" Value="1"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding IsInstaPrinterTemplate,UpdateSourceTrigger=PropertyChanged}" Value="False">
                                                                                        <Setter Property="Opacity" Value="0"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </Path.Style>
                                                                    </Path>
                                                                    <ToggleButton x:Name="toggle" 
                                                                            IsHitTestVisible="False"
                                                                            Margin="7"
                                                                            IsChecked="{TemplateBinding IsChecked}">
                                                                        <ToggleButton.Style>
                                                                            <Style TargetType="{x:Type ToggleButton}">
                                                                                <Setter Property="Background" Value="White" />
                                                                                <Setter Property="Padding" Value="5" />
                                                                                <Setter Property="IsThreeState" Value="False" />
                                                                                <Setter Property="Template">
                                                                                    <Setter.Value>
                                                                                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                                                            <Border>
                                                                                                <Grid>
                                                                                                    <Ellipse Stretch="Fill" Fill="#ffffff" />
                                                                                                    <Ellipse Stretch="Fill" Fill="#4ecdc4">
                                                                                                        <Ellipse.RenderTransform>
                                                                                                            <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                                                                                        </Ellipse.RenderTransform>
                                                                                                        <Ellipse.RenderTransformOrigin>
                                                                                                            <Point X="0.5" Y="0.5"></Point>
                                                                                                        </Ellipse.RenderTransformOrigin>
                                                                                                    </Ellipse>
                                                                                                    <Border Background="Transparent"
                                                                                                            BorderBrush="Transparent"
                                                                                                            VerticalAlignment="Center"
                                                                                                            HorizontalAlignment="Center">
                                                                                                        <Path Data="M 0,0 L 11,-2 L 8,5" x:Name="Tick" Stroke="Transparent" StrokeThickness="1">
                                                                                                            <Path.RenderTransform>
                                                                                                                <RotateTransform Angle="135" CenterX="5.5" CenterY="1"/>
                                                                                                            </Path.RenderTransform>
                                                                                                        </Path>
                                                                                                    </Border>
                                                                                                </Grid>

                                                                                            </Border>
                                                                                            <ControlTemplate.Triggers>
                                                                                                <Trigger Property="IsChecked" Value="True">
                                                                                                    <Setter TargetName="Tick" Property="Stroke" Value="#ffffff" />
                                                                                                </Trigger>
                                                                                            </ControlTemplate.Triggers>
                                                                                        </ControlTemplate>
                                                                                    </Setter.Value>
                                                                                </Setter>
                                                                            </Style>
                                                                        </ToggleButton.Style>
                                                                    </ToggleButton>
                                                                </DockPanel>
                                                            </Grid>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="UIElement.IsMouseOver" Value="True">
                                                                <Setter TargetName="overlay" Property="Opacity" Value="0.2" />
                                                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="#4ecdc4" />
                                                            </Trigger>
                                                            <Trigger Property="IsChecked" Value="True">
                                                                <Setter TargetName="overlay" Property="Opacity" Value="0.2" />
                                                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="#4ecdc4" />
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>

                                        </Style>
                                    </ToggleButton.Style>
                                </ToggleButton>

                            </DataTemplate>
                        </Grid.Resources>

                        <ListBox Background="Transparent"
                                ItemTemplate="{StaticResource tmpl}"
                                SelectedItem="{Binding Path=SelectedTemplate}"
                                ItemsSource="{Binding Source={StaticResource Source}}"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                SelectionMode="Single">
                            <ListBox.Resources>
                                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#00000000"/>
                                <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#00000000"/>
                            </ListBox.Resources>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" IsItemsHost="True" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="{x:Type ListBoxItem}">
                                    <Setter Property="IsSelected" Value="{Binding IsChecked}" />
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ListBox>
                        <spinningWheel:SpinningWheel HorizontalAlignment="Center"
                                Radius="50"
                                Grid.Column="0"
                                IsSpinning="{Binding Path=IsBusyLoading}" 
                                Visibility="{Binding Path=IsBusyLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </Grid>
                </Border>
                <Border  Padding="10" Grid.Row="2">
                    <Grid Width="880" Height="85">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="0.25*"/>
                            <ColumnDefinition Width="0.5*"/>
                            <ColumnDefinition Width="0.25*"/>
                        </Grid.ColumnDefinitions>
                        <customControls:BlueButton Command="{Binding Path=GoBackCommand}"
                                CornerRadius="40"
                                InnerCornerRadius="60"
                                Padding="5"
                                Grid.Column="0"
                                FontSize="18"
                                HorizontalAlignment="Stretch"
                                Content="Назад" 
                                ShowBackButton="True" 
                                CornerAlign="BottomLeft,TopLeft"/>
                        <customControls:DataPagerCtl Grid.Column="1" 
                                ItemsView="{Binding Source={StaticResource Source}}" 
                                PageSize="15"
                                PagesInRow="3"
                                Background="#4ecdc4"/>
                        <customControls:BlueButton Command="{Binding Path=SaveCommand}"
                                CornerRadius="40"
                                InnerCornerRadius="60"
                                FontSize="18"
                                HorizontalAlignment="Stretch"
                                Grid.Column="2"
                                CornerAlign="TopRight,BottomRight"
                                Content="Сохранить"/>
                    </Grid>
                </Border>
            </Grid>
        </Viewbox>
    </Border>
</UserControl>
